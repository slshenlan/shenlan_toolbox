"use strict";(self["webpackChunkshenlan_tool"]=self["webpackChunkshenlan_tool"]||[]).push([[44],{67463:function(t,e,i){i.r(e),i.d(e,{default:function(){return l}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page"},[e("Card",{staticClass:"sl-pub-card"},[e("p",{attrs:{slot:"title"},slot:"title"},[t._v("添加水印")]),e("div",{staticClass:"card-extra",attrs:{slot:"extra"},slot:"extra"},[e("sl-upload",{on:{onToImage:t.handleBeforeUpload}},[e("Button",{attrs:{type:"success"}},[t._v("上传图片")])],1),e("Button",{staticClass:"sl-margin-left-10",attrs:{type:"primary"},on:{click:t.exportImage}},[t._v("导出图片")]),e("Button",{staticClass:"sl-margin-left-10",attrs:{type:"primary"},on:{click:t.watermaskDrawerShow}},[t._v("设置水印")])],1),e("div",[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.imgList.length,expression:"!imgList.length"}]},[e("sl-upload",{attrs:{"has-border":""},on:{onToImage:t.handleBeforeUpload}},[e("div",{staticStyle:{padding:"80px 0"}},[e("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"52"}}),e("p",[t._v("点击或者拖拽图片到这里")])],1)])],1),t._l(t.imgList,(function(t,i){return e("div",{key:i,staticClass:"img-item",style:{width:t.width+32+"px"}},[e("canvas",{ref:"refCanvas"+i,refInFor:!0,staticClass:"img-canvas",attrs:{width:t.width,height:t.height}})])}))],2)]),e("sl-watermask-drawer",{ref:"slWatermaskDrawer",on:{onSet:t.setWatermask,onExportImage:t.exportImage}})],1)},r=[],o=i(98290),s=o.Z,n=i(43736),h=(0,n.Z)(s,a,r,!1,null,null,null),l=h.exports},16738:function(t,e,i){i.d(e,{Z:function(){return c}});var a=function(){var t=this,e=t._self._c;return e("div",[e("Drawer",{attrs:{"mask-style":t.drawer.maskStyle,width:300,title:"属性栏",placement:"right"},model:{value:t.drawer.show,callback:function(e){t.$set(t.drawer,"show",e)},expression:"drawer.show"}},[e("div",{staticClass:"option-bar"},[e("Form",{attrs:{"label-width":70}},[e("FormItem",{attrs:{label:"水印图片"}},[e("sl-upload",{attrs:{multiple:!1},on:{onToImage:t.handleWaterMarkIconUpload}},[e("div",{staticStyle:{width:"30px",height:"30px","line-height":"35px"}},[e("Icon",{attrs:{type:"md-images",size:"20"}})],1)]),e("br"),e("img",{directives:[{name:"show",rawName:"v-show",value:t.form.icon,expression:"form.icon"}],ref:"iconPrev",staticClass:"water-mark-img"})],1),e("FormItem",{attrs:{label:"位置"}},[e("Select",{staticStyle:{width:"200px"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},[e("Option",{attrs:{value:10}},[t._v("铺满")]),e("Option",{attrs:{value:1}},[t._v("左上")]),e("Option",{attrs:{value:2}},[t._v("左中")]),e("Option",{attrs:{value:3}},[t._v("左下")]),e("Option",{attrs:{value:4}},[t._v("右上")]),e("Option",{attrs:{value:5}},[t._v("右中")]),e("Option",{attrs:{value:6}},[t._v("右下")]),e("Option",{attrs:{value:7}},[t._v("中上")]),e("Option",{attrs:{value:8}},[t._v("中间")]),e("Option",{attrs:{value:9}},[t._v("中下")])],1)],1),e("FormItem",{attrs:{label:"水印大小"}},[e("Slider",{attrs:{max:500,min:20,step:5},model:{value:t.form.iconSize,callback:function(e){t.$set(t.form,"iconSize",e)},expression:"form.iconSize"}})],1),e("FormItem",{attrs:{label:"透明度"}},[e("Slider",{attrs:{max:100,min:10},model:{value:t.form.globalAlpha,callback:function(e){t.$set(t.form,"globalAlpha",e)},expression:"form.globalAlpha"}})],1),e("FormItem",{attrs:{label:"上下间距"}},[e("Slider",{attrs:{max:500,min:0},model:{value:t.form.horizontalSpacing,callback:function(e){t.$set(t.form,"horizontalSpacing",e)},expression:"form.horizontalSpacing"}})],1),e("FormItem",{attrs:{label:"左右间距"}},[e("Slider",{attrs:{max:500,min:0},model:{value:t.form.portraitSpacing,callback:function(e){t.$set(t.form,"portraitSpacing",e)},expression:"form.portraitSpacing"}})],1),e("FormItem",{attrs:{label:"旋转角度"}},[e("Slider",{attrs:{max:180,min:-180,step:5},model:{value:t.form.rotateAngle,callback:function(e){t.$set(t.form,"rotateAngle",e)},expression:"form.rotateAngle"}})],1)],1),e("div",[e("Button",{attrs:{type:"primary"},on:{click:t.handleExportImage}},[t._v("导出图片")])],1)],1)])],1)},r=[],o=i(44512),s={name:"SlWatermaskDrawer",components:{SlUpload:o.Z},mixins:[],props:{},data(){return{drawer:{show:!1,maskStyle:{backgroundColor:"transparent"}},form:{iconSize:50,globalAlpha:100,type:10,portraitSpacing:20,horizontalSpacing:20,rotateAngle:0,icon:void 0}}},computed:{iconSize(){let t={width:this.form.iconSize,height:this.form.iconSize};const e=this.form.icon;if(!e)return!1;if(e.width>e.height){const i=e.width/e.height;t.height=t.width/i}else{const i=e.height/e.width;t.width=t.height/i}return t}},watch:{form:{handler(){this.slDebounce||(this.slDebounce=this.$pub.slDebounce((()=>{this.handleFormChange()}))),this.slDebounce()},deep:!0,immediate:!1}},beforeDestroy(){},mounted(){this.$nextTick((()=>{}))},methods:{show(){this.drawer.show=!0},handleWaterMarkIconUpload(t){this.form.icon=t.img,this.$refs.iconPrev.src=t.img.src},getIconSize(){return this.iconSize},getForm(){return this.form},handleFormChange(){this.$emit("onSet",{iconSize:this.iconSize,form:this.form})},handleExportImage(){this.$emit("onExportImage")}}},n=s,h=i(43736),l=(0,h.Z)(n,a,r,!1,null,"06e0716b",null),m=l.exports,c=m},16307:function(t,e,i){var a=i(27954),r=i.n(a),o=i(93640),s=i.n(o);e["Z"]={data(){return{}},computed:{},beforeDestroy(){},mounted(){this.$nextTick((()=>{}))},methods:{downloadImages(){try{if(!this.imgList.length)throw"请选择需要添加水印的图片";if(!this.form.icon)throw"请选择需要添加的水印图片";this.$Spin.show({render:t=>t("div",[t("Icon",{class:"demo-spin-icon-load",props:{type:"ios-loading",size:18}}),t("div","Loading")])}),this.dowmloadRenderExportImage()}catch(t){this.$Message.warning(t)}},dowmloadRenderExportImage(){const t=new(r()),e=t.folder("images");this.imgList.forEach(((i,a)=>{let r=this.getCanvas(a);e.file(i.fileName,r.toDataURL("image/jpeg",1).substring(22),{base64:!0}),a===this.imgList.length-1&&(this.$Spin.hide(),t.generateAsync({type:"blob"}).then((function(t){s()(t,"watermask.zip")})))}))}}}},92792:function(t,e,i){i(57658);e["Z"]={data(){return{}},methods:{watermaskRenderImg(t,e){let i=this.getCanvas(t),a=e.width,r=e.height,o=i.getContext("2d");o.clearRect(0,0,a,r),o.globalAlpha=1,o.drawImage(e.img,0,0,a,r),this.watermaskRenderIcon(o,e)},watermaskRenderIcon(t,e){if(this.form.icon){let i=this.watermaskHandlePosition(e);t.globalAlpha=this.form.globalAlpha/100,t.translate(i.center.x,i.center.y),t.rotate(Math.PI/180*this.form.rotateAngle);for(let e=0;e<i.points.length;e++){const a=i.points[e];t.drawImage(this.form.icon,a.x,a.y,this.iconSize.width,this.iconSize.height)}t.rotate(Math.PI/180*this.form.rotateAngle*-1),t.translate(-1*i.center.x,-1*i.center.y)}},watermaskHandlePosition(t){let e,i=[],a=t.width,r=t.height;if(1==this.form.type){e={x:0,y:0};let t={x:this.form.portraitSpacing,y:this.form.horizontalSpacing};i.push(t)}if(2==this.form.type){e={x:0,y:r/2};let t={x:this.form.portraitSpacing,y:this.form.horizontalSpacing-this.iconSize.height/2};i.push(t)}if(3==this.form.type){e={x:0,y:r};let t={x:this.form.portraitSpacing,y:-1*(this.form.horizontalSpacing+this.iconSize.height)};i.push(t)}if(4==this.form.type){e={x:a,y:0};let t={x:-1*(this.form.portraitSpacing+this.iconSize.width),y:this.form.horizontalSpacing};i.push(t)}if(5==this.form.type){e={x:a,y:r/2};let t={x:-1*(this.form.portraitSpacing+this.iconSize.width),y:this.form.horizontalSpacing-this.iconSize.height/2};i.push(t)}if(6==this.form.type){e={x:a,y:r};let t={x:-1*(this.form.portraitSpacing+this.iconSize.width),y:-1*(this.form.horizontalSpacing+this.iconSize.height)};i.push(t)}if(7==this.form.type){e={x:a/2,y:0};let t={x:this.form.portraitSpacing-this.iconSize.width/2,y:this.form.horizontalSpacing};i.push(t)}if(8==this.form.type){e={x:a/2,y:r/2};let t={x:this.form.portraitSpacing-this.iconSize.width/2,y:this.form.horizontalSpacing-this.iconSize.height/2};i.push(t)}if(9==this.form.type){e={x:a/2,y:r};let t={x:this.form.portraitSpacing-this.iconSize.width/2,y:-1*(this.form.horizontalSpacing+this.iconSize.height)};i.push(t)}if(10==this.form.type){e={x:a/2,y:r/2};const t=this.iconSize.width+this.form.portraitSpacing,s=this.iconSize.height+this.form.horizontalSpacing;var o=Math.sqrt(Math.pow(a,2)+Math.pow(r,2))/2;let n=-1*o;while(n<o){let e=-1*o;while(e<o)i.push({x:e,y:n}),e+=t;n+=s}}return{points:i,center:e}}}}},98290:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(57658),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__),_components_SlUpload__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(44512),_components_SlWatermaskDrawer__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(16738),_mixins_watermask__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(92792),_mixins_download__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(16307);__webpack_exports__["Z"]={components:{SlUpload:_components_SlUpload__WEBPACK_IMPORTED_MODULE_1__.Z,SlWatermaskDrawer:_components_SlWatermaskDrawer__WEBPACK_IMPORTED_MODULE_2__.Z},mixins:[_mixins_watermask__WEBPACK_IMPORTED_MODULE_3__.Z,_mixins_download__WEBPACK_IMPORTED_MODULE_4__.Z],data(){return{imgList:[],iconSize:0,form:{}}},mounted(){this.$nextTick((()=>{let t=this.$refs.slWatermaskDrawer;this.iconSize=t.getIconSize,this.form=t.getForm}))},methods:{watermaskDrawerShow(){this.$refs.slWatermaskDrawer.show()},handleBeforeUpload(t){this.imgList.push(t),this.$nextTick((()=>{this.watermaskRenderImg(this.imgList.length-1,t)}))},setWatermask(t){this.iconSize=t.iconSize,this.form=t.form,this.imgList.length&&this.form.icon&&this.imgList.forEach(((t,e)=>{this.watermaskRenderImg(e,t)}))},exportImage(){this.downloadImages()},getCanvas(index){return eval("this.$refs.refCanvas"+index)[0]}}}}}]);